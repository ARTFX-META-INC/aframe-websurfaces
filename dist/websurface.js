var e=require("three"),t=require("three/examples/jsm/renderers/CSS3DRenderer"),i=function(){function i(i,s){this.websurfaceEntity=s,this.enabled=!0,this.cssRenderer=new t.CSS3DRenderer,this.domElement=this.cssRenderer.domElement;var n=document.createElement("div");n.style.position="fixed",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="-1",this.domElement.appendChild(n),n.addEventListener("click",function(e){s.sceneEl.style.zIndex=2}),this.cssCamera=new e.PerspectiveCamera(i.fov,i.aspect,100*i.near,100*i.far),this.camera=i,this.cssScene=new e.Scene,this.update=this.update.bind(this)}var s=i.prototype;return s.setSize=function(e,t){this.cssRenderer.setSize(e,t),this.cssCamera.aspect=e/t,this.cssCamera.updateProjectionMatrix()},s.update=function(){var t=new e.Vector3,i=new e.Quaternion,s=new e.Vector3;this.camera.matrixWorld.decompose(t,i,s),this.cssCamera.quaternion.copy(i),this.cssCamera.position.copy(t).multiplyScalar(100),this.cssRenderer.render(this.cssScene,this.cssCamera)},i}();function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var n=function(i){var n,a;function o(s,n,a,o,r){var c,d=(void 0===r?{}:r).elementWidth,l=void 0===d?1280:d,h=new e.PlaneGeometry(a,o),m=new e.MeshBasicMaterial({opacity:0,blending:e.NoBlending,side:e.DoubleSide,color:new e.Color(0,0,0)});return(c=i.call(this,h,m)||this).context=s,c.domElement=n,c.aspectRatio=o/a,c.elementWidth=l,c.elementHeight=c.elementWidth*c.aspectRatio,c.width=a,c.height=o,c.resizeElement(),c.cssObject=new t.CSS3DObject(c.domElement),c.cssObject.scale.multiplyScalar(100/(c.elementWidth/c.width)),c.cssObjectInitialScale=c.cssObject.scale,c.size=new e.Vector3,c.box=new e.Box3,c.addEventListener("added",c.handleAdded),c.addEventListener("removed",c.handleRemoved),c.update=c.update.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c)),c}a=i,(n=o).prototype=Object.create(a.prototype),n.prototype.constructor=n,s(n,a);var r=o.prototype;return r.handleAdded=function(){this.context.cssScene.add(this.cssObject)},r.handleRemoved=function(){this.context.cssScene.remove(this.cssObject)},r.resizeElement=function(){this.domElement.style.width=this.elementWidth+"px",this.domElement.style.height=this.elementHeight+"px"},r.setElement=function(e){this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=e,this.cssObject.element=e,this.resizeElement()},r.update=function(e){this.cssObject.quaternion.copy(e.quaternion),this.cssObject.position.copy(e.position).multiplyScalar(100),this.box.setFromObject(this).getSize(this.size);var t=e.scale;this.oldScaleFactor!=t&&(this.oldScaleFactor=t,this.cssObject.scale.set(this.cssObjectInitialScale.x,this.cssObjectInitialScale.y,this.cssObjectInitialScale.z),this.cssObject.scale.multiply(t)),this.cssObject.visible=e.visible},r.dispose=function(){this.removeEventListener("added",this.handleAdded),this.removeEventListener("removed",this.handleRemoved),this.domElement.remove(),this.geometry.dispose(),this.material.dispose()},o}(e.Mesh),a=AFRAME.registerComponent("websurface",{schema:{url:{default:"https://aframe.io"},width:{default:1},height:{default:.75},frameSkips:{default:1},autoSceneStyling:{default:!0}},init:function(){var e=this.el,t=this.data;1==t.autoSceneStyling&&(e.sceneEl.style.position="absolute"),t.mouseHasLeftScreen=!0,e.setAttribute("geometry","primitive:plane; width:"+t.width+"; height:"+t.height+";"),e.addEventListener("click",function(){0!=t.mouseHasLeftScreen&&(document.exitPointerLock(),e.sceneEl.style.zIndex=-2,t.mouseHasLeftScreen=!1)}),e.addEventListener("mouseleave",function(){t.mouseHasLeftScreen=!0}),e.sceneEl.addEventListener("cam-loaded",function(){var s=document.createElement("iframe");s.setAttribute("src",t.url),s.style.border="none";var a=new i(e.sceneEl.camera,e);a.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(a.domElement);var o=new n(a,s,t.width,t.height);e.object3D.add(o),t.context=a,t.element=o,window.addEventListener("resize",function(){a.setSize(window.innerWidth,window.innerHeight)})}),t.frames=0,t.isCamLoaded=!1},tick:function(){var e=this.el,t=this.data;if(0!=t.isCamLoaded){var i=t.context,s=t.element;t.frames%t.frameSkips==0&&(i&&i.update(),s&&s.update(e.object3D)),t.frames++}else e.sceneEl.camera&&(this.el.emit("cam-loaded"),t.isCamLoaded=!0)}});exports.component=a;
//# sourceMappingURL=websurface.js.map
