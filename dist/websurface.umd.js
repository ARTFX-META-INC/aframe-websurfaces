!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("three/examples/jsm/renderers/CSS3DRenderer")):"function"==typeof define&&define.amd?define(["exports","three","three/examples/jsm/renderers/CSS3DRenderer"],t):t((e||self).aframeWebsurfaces={},e.THREE,e.CSS3DRenderer)}(this,function(e,t,i){var s=100,n=function(){function e(e,n){this.websurfaceEntity=n,this.enabled=!0,this.cssRenderer=new i.CSS3DRenderer,this.domElement=this.cssRenderer.domElement,this.cssCamera=new t.PerspectiveCamera(e.fov,e.aspect,e.near*s,e.far*s),this.camera=e,this.cssScene=new t.Scene,this.update=this.update.bind(this)}var n=e.prototype;return n.setSize=function(e,t){this.cssRenderer.setSize(e,t),this.cssCamera.aspect=e/t,this.cssCamera.updateProjectionMatrix()},n.update=function(){var e=new t.Vector3,i=new t.Quaternion,n=new t.Vector3;this.camera.matrixWorld.decompose(e,i,n),this.cssCamera.quaternion.copy(i),this.cssCamera.position.copy(e).multiplyScalar(s),this.cssRenderer.render(this.cssScene,this.cssCamera)},e}();function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var n,r;function o(n,a,r,o,c){var d,l=(void 0===c?{}:c).elementWidth,h=void 0===l?1280:l,m=new t.PlaneGeometry(r,o),u=new t.MeshBasicMaterial({opacity:0,blending:t.NoBlending,side:t.DoubleSide,color:new t.Color(0,0,0)});return(d=e.call(this,m,u)||this).context=n,d.domElement=a,d.aspectRatio=o/r,d.elementWidth=h,d.elementHeight=d.elementWidth*d.aspectRatio,d.width=r,d.height=o,d.resizeElement(),d.cssObject=new i.CSS3DObject(d.domElement),d.cssObject.scale.multiplyScalar(s/(d.elementWidth/d.width)),d.cssObjectInitialScale=d.cssObject.scale,d.size=new t.Vector3,d.box=new t.Box3,d.addEventListener("added",d.handleAdded),d.addEventListener("removed",d.handleRemoved),d.update=d.update.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(d)),d}r=e,(n=o).prototype=Object.create(r.prototype),n.prototype.constructor=n,a(n,r);var c=o.prototype;return c.handleAdded=function(){this.context.cssScene.add(this.cssObject)},c.handleRemoved=function(){this.context.cssScene.remove(this.cssObject)},c.resizeElement=function(){this.domElement.style.width=this.elementWidth+"px",this.domElement.style.height=this.elementHeight+"px"},c.setElement=function(e){this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=e,this.cssObject.element=e,this.resizeElement()},c.update=function(e){this.cssObject.quaternion.copy(e.quaternion),this.cssObject.position.copy(e.position).multiplyScalar(s),this.box.setFromObject(this).getSize(this.size);var t=e.scale;this.oldScaleFactor!=t&&(this.oldScaleFactor=t,this.cssObject.scale.set(this.cssObjectInitialScale.x,this.cssObjectInitialScale.y,this.cssObjectInitialScale.z),this.cssObject.scale.multiply(t)),this.cssObject.visible=e.visible},c.dispose=function(){this.removeEventListener("added",this.handleAdded),this.removeEventListener("removed",this.handleRemoved),this.domElement.remove(),this.geometry.dispose(),this.material.dispose()},o}(t.Mesh),o=AFRAME.registerComponent("websurface",{schema:{url:{default:"https://aframe.io"},width:{default:1},height:{default:.75},isInteractable:{default:!0},frameSkips:{default:1},autoSceneStyling:{default:!0}},init:function(){var e=this.el,t=this.data;1==t.autoSceneStyling&&(e.sceneEl.style.position="absolute",e.sceneEl.style.zIndex="2"),1==t.isInteractable&&(t.mouseHasLeftScreen=!0,e.setAttribute("geometry","primitive:plane; width:"+t.width+"; height:"+t.height+";"),e.addEventListener("click",function(){0!=t.mouseHasLeftScreen&&(document.exitPointerLock(),e.sceneEl.style.zIndex=-2,t.mouseHasLeftScreen=!1)}),e.addEventListener("mouseleave",function(){t.mouseHasLeftScreen=!0})),e.addEventListener("cam-loaded",function(){var i=document.createElement("iframe");i.setAttribute("src",t.url),i.style.border="none";var s=new n(e.sceneEl.camera,e);s.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(s.domElement);var a=new r(s,i,t.width,t.height);if(e.object3D.add(a),1==t.isInteractable){var o=document.createElement("div");o.style.position="fixed",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.zIndex="-1",s.domElement.appendChild(o),o.addEventListener("click",function(){e.sceneEl.style.zIndex=2})}this.websurface_iframe=i,t.context=s,t.element=a,window.addEventListener("resize",function(){s.setSize(window.innerWidth,window.innerHeight)})}),t.frames=0,t.isCamLoaded=!1},tick:function(){var e=this.el,t=this.data;if(0!=t.isCamLoaded){var i=t.context,s=t.element;t.frames%t.frameSkips==0&&(i&&i.update(),s&&s.update(e.object3D)),t.frames++}else e.sceneEl.camera&&(this.el.emit("cam-loaded"),t.isCamLoaded=!0)}});e.component=o});
//# sourceMappingURL=websurface.umd.js.map
