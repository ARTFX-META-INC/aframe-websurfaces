import{PerspectiveCamera as e,Scene as t,Vector3 as i,Quaternion as s,PlaneGeometry as n,MeshBasicMaterial as a,NoBlending as c,DoubleSide as o,Color as r,Box3 as d,Mesh as l}from"three";import{CSS3DRenderer as h,CSS3DObject as m}from"three/examples/jsm/renderers/CSS3DRenderer";var u=function(){function n(i,s){this.websurfaceEntity=s,this.enabled=!0,this.cssRenderer=new h,this.domElement=this.cssRenderer.domElement,this.cssCamera=new e(i.fov,i.aspect,100*i.near,100*i.far),this.camera=i,this.cssScene=new t,this.update=this.update.bind(this)}var a=n.prototype;return a.setSize=function(e,t){this.cssRenderer.setSize(e,t),this.cssCamera.aspect=e/t,this.cssCamera.updateProjectionMatrix()},a.update=function(){var e=new i,t=new s,n=new i;this.camera.matrixWorld.decompose(e,t,n),this.cssCamera.quaternion.copy(t),this.cssCamera.position.copy(e).multiplyScalar(100),this.cssRenderer.render(this.cssScene,this.cssCamera)},n}();function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){var t,s;function l(t,s,l,h,u){var p,f=(void 0===u?{}:u).elementWidth,v=void 0===f?1280:f,b=new n(l,h),w=new a({opacity:0,blending:c,side:o,color:new r(0,0,0)});return(p=e.call(this,b,w)||this).context=t,p.domElement=s,p.aspectRatio=h/l,p.elementWidth=v,p.elementHeight=p.elementWidth*p.aspectRatio,p.width=l,p.height=h,p.resizeElement(),p.cssObject=new m(p.domElement),p.cssObject.scale.multiplyScalar(100/(p.elementWidth/p.width)),p.cssObjectInitialScale=p.cssObject.scale,p.size=new i,p.box=new d,p.addEventListener("added",p.handleAdded),p.addEventListener("removed",p.handleRemoved),p.update=p.update.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(p)),p}s=e,(t=l).prototype=Object.create(s.prototype),t.prototype.constructor=t,p(t,s);var h=l.prototype;return h.handleAdded=function(){this.context.cssScene.add(this.cssObject)},h.handleRemoved=function(){this.context.cssScene.remove(this.cssObject)},h.resizeElement=function(){this.domElement.style.width=this.elementWidth+"px",this.domElement.style.height=this.elementHeight+"px"},h.setElement=function(e){this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=e,this.cssObject.element=e,this.resizeElement()},h.update=function(e){this.cssObject.quaternion.copy(e.quaternion),this.cssObject.position.copy(e.position).multiplyScalar(100),this.box.setFromObject(this).getSize(this.size);var t=e.scale;this.oldScaleFactor!=t&&(this.oldScaleFactor=t,this.cssObject.scale.set(this.cssObjectInitialScale.x,this.cssObjectInitialScale.y,this.cssObjectInitialScale.z),this.cssObject.scale.multiply(t)),this.cssObject.visible=e.visible},h.dispose=function(){this.removeEventListener("added",this.handleAdded),this.removeEventListener("removed",this.handleRemoved),this.domElement.remove(),this.geometry.dispose(),this.material.dispose()},l}(l),v=AFRAME.registerComponent("websurface",{schema:{url:{default:"https://aframe.io"},width:{default:1},height:{default:.75},isInteractable:{default:!0},frameSkips:{default:1},autoSceneStyling:{default:!0}},init:function(){var e=this.el,t=this.data;1==t.autoSceneStyling&&(e.sceneEl.style.position="absolute",e.sceneEl.style.zIndex="2"),1==t.isInteractable&&(t.mouseHasLeftScreen=!0,e.setAttribute("geometry","primitive:plane; width:"+t.width+"; height:"+t.height+";"),e.addEventListener("click",function(){0!=t.mouseHasLeftScreen&&(document.exitPointerLock(),e.sceneEl.style.zIndex=-2,t.mouseHasLeftScreen=!1)}),e.addEventListener("mouseleave",function(){t.mouseHasLeftScreen=!0})),e.addEventListener("cam-loaded",function(){var i=document.createElement("iframe");i.setAttribute("src",t.url),i.style.border="none";var s=new u(e.sceneEl.camera,e);s.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(s.domElement);var n=new f(s,i,t.width,t.height);if(e.object3D.add(n),1==t.isInteractable){var a=document.createElement("div");a.style.position="fixed",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="-1",s.domElement.appendChild(a),a.addEventListener("click",function(){e.sceneEl.style.zIndex=2})}this.websurface_iframe=i,t.context=s,t.element=n,window.addEventListener("resize",function(){s.setSize(window.innerWidth,window.innerHeight)})}),t.frames=0,t.isCamLoaded=!1},tick:function(){var e=this.el,t=this.data;if(0!=t.isCamLoaded){var i=t.context,s=t.element;t.frames%t.frameSkips==0&&(i&&i.update(),s&&s.update(e.object3D)),t.frames++}else e.sceneEl.camera&&(this.el.emit("cam-loaded"),t.isCamLoaded=!0)}});export{v as component};
//# sourceMappingURL=websurface.module.js.map
