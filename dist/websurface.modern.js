import{PerspectiveCamera as e,Scene as t,Vector3 as s,Quaternion as i,Mesh as n,PlaneGeometry as d,MeshBasicMaterial as c,NoBlending as a,DoubleSide as h,Color as o,Box3 as l}from"three";import{CSS3DRenderer as r,CSS3DObject as m}from"three/examples/jsm/renderers/CSS3DRenderer";class p{constructor(s,i){this.websurfaceEntity=i,this.enabled=!0,this.cssRenderer=new r,this.domElement=this.cssRenderer.domElement,this.cssCamera=new e(s.fov,s.aspect,100*s.near,100*s.far),this.camera=s,this.cssScene=new t,this.update=this.update.bind(this)}setSize(e,t){this.cssRenderer.setSize(e,t),this.cssCamera.aspect=e/t,this.cssCamera.updateProjectionMatrix()}update(){let e=new s,t=new i,n=new s;this.camera.matrixWorld.decompose(e,t,n),this.cssCamera.quaternion.copy(t),this.cssCamera.position.copy(e).multiplyScalar(100),this.cssRenderer.render(this.cssScene,this.cssCamera)}}class u extends n{constructor(e,t,i,n,{elementWidth:r=1280}={}){super(new d(i,n),new c({opacity:0,blending:a,side:h,color:new o(0,0,0)})),this.context=e,this.domElement=t,this.aspectRatio=n/i,this.elementWidth=r,this.elementHeight=this.elementWidth*this.aspectRatio,this.width=i,this.height=n,this.resizeElement(),this.cssObject=new m(this.domElement),this.cssObject.scale.multiplyScalar(100/(this.elementWidth/this.width)),this.cssObjectInitialScale=this.cssObject.scale,this.size=new s,this.box=new l,this.addEventListener("added",this.handleAdded),this.addEventListener("removed",this.handleRemoved),this.update=this.update.bind(this)}handleAdded(){this.context.cssScene.add(this.cssObject)}handleRemoved(){this.context.cssScene.remove(this.cssObject)}resizeElement(){this.domElement.style.width=`${this.elementWidth}px`,this.domElement.style.height=`${this.elementHeight}px`}setElement(e){this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=e,this.cssObject.element=e,this.resizeElement()}update(e){this.cssObject.quaternion.copy(e.quaternion),this.cssObject.position.copy(e.position).multiplyScalar(100),this.box.setFromObject(this).getSize(this.size);const t=e.scale;this.oldScaleFactor!=t&&(this.oldScaleFactor=t,this.cssObject.scale.set(this.cssObjectInitialScale.x,this.cssObjectInitialScale.y,this.cssObjectInitialScale.z),this.cssObject.scale.multiply(t)),this.cssObject.visible=e.visible}dispose(){this.removeEventListener("added",this.handleAdded),this.removeEventListener("removed",this.handleRemoved),this.domElement.remove(),this.geometry.dispose(),this.material.dispose()}}const b=AFRAME.registerComponent("websurface",{schema:{url:{default:"https://aframe.io"},width:{default:1},height:{default:.75},isInteractable:{default:!0},frameSkips:{default:1},autoSceneStyling:{default:!0}},init:function(){const e=this.el,t=this.data;1==t.autoSceneStyling&&(e.sceneEl.style.position="absolute",e.sceneEl.style.zIndex="2"),1==t.isInteractable&&(t.mouseHasLeftScreen=!0,e.setAttribute("geometry",`primitive:plane; width:${t.width}; height:${t.height};`),e.addEventListener("click",function(){0!=t.mouseHasLeftScreen&&(document.exitPointerLock(),e.sceneEl.style.zIndex=-2,t.mouseHasLeftScreen=!1)}),e.addEventListener("mouseleave",function(){t.mouseHasLeftScreen=!0})),e.addEventListener("cam-loaded",function(){const s=document.createElement("iframe");s.setAttribute("src",t.url),s.style.border="none";const i=new p(e.sceneEl.camera,e);i.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(i.domElement);const n=new u(i,s,t.width,t.height);if(e.object3D.add(n),1==t.isInteractable){const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.zIndex="-1",i.domElement.appendChild(t),t.addEventListener("click",function(){e.sceneEl.style.zIndex=2})}t.context=i,t.element=n,window.addEventListener("resize",()=>{i.setSize(window.innerWidth,window.innerHeight)})}),t.frames=0,t.isCamLoaded=!1},tick:function(){const e=this.el,t=this.data;if(0==t.isCamLoaded)return void(e.sceneEl.camera&&(this.el.emit("cam-loaded"),t.isCamLoaded=!0));const s=t.context,i=t.element;t.frames%t.frameSkips==0&&(s&&s.update(),i&&i.update(e.object3D)),t.frames++},remove:function(){}});export{b as component};
//# sourceMappingURL=websurface.modern.js.map
